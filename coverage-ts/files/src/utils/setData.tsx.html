
  <!DOCTYPE html>
  <html>
    <head>
      <title>setData.tsx</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">src/utils/setData.tsx</td><td class="">73.54%</td><td class="">80%</td><td class="">291</td><td class="">214</td><td class="">77</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { Question, Sheet, Tile } from &#x27;types&#x27;
import { useFetch } from &#x27;./hooks&#x27;

/*
 * isEventSource is true when fetching for a stream
 */
export const setHeaders = (isEventSource: boolean) =&gt; {
  const token = localStorage.getItem(&#x27;authToken&#x27;)

  const headers = isEventSource
    ? {
        Authorization: `Bearer ${token}`,
      }
    : {
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
        Authorization: `Bearer ${token}`,
      }

  return headers
}

/***************************
		USER QUESTION
 **************************/

export const setContactData = (subject: string, text: string, institution: string) =&gt; {
  const data = {
    subject: subject,
    text: text,
    institution: institution,
  }

  return JSON.stringify(data)
}

export const setUserQuestion = (question) =&gt; {
  const data = {
    institution: question.institution,
    query: question.query,
    context: question.context,
    links: question.links,
    temperature: question.temperature,
    model_name: question.model_name,
    limit: question.limit,
    mode: question.mode,
    sources: question.sources,
    must_not_sids: question.must_not_sids,
  }

  return data
}

export const setQuestionFromRegeneration = (
  mode: string,
  text,
  limit: number,
  must_not_sids: string[]
) =&gt; {
  const data = {
    model_name: &#x27;albert-light&#x27;,
    mode: mode,
    query: text,
    limit: limit,
    context: &#x27;&#x27;,
    institution: &#x27;&#x27;,
    links: &#x27;&#x27;,
    temperature: 20,
    must_not_sids: must_not_sids,
  }

  return data
}

export const setQuestionWithContext = (question: string, context) =&gt; {
  const administrations = context.administrations.length
    ? &#x27;Les administrations concernées par cette question sont : &#x27; +
      context.administrations.map((adminstration) =&gt; adminstration)
    : &#x27;&#x27;
  const themes = context.themes.length
    ? &#x27;La question porte sur les thèmes suivants : &#x27; +
      context.themes.map((theme) =&gt; theme)
    : &#x27;&#x27;
  const questionWithContext = question + &#x27;\n&#x27; + administrations + &#x27;\n&#x27; + themes

  return questionWithContext
}

export const rmContextFromQuestion = (
  str: string,
  setQuery: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt; | undefined
) =&gt; {
  const context = [
    &#x27;Les administrations concernées par cette question sont : &#x27;,
    &#x27;La question porte sur les thèmes suivants : &#x27;,
  ]

  let newStr = str

  context.forEach((c) =&gt; {
    const start = newStr.indexOf(c)

    if (start !== -1) {
      newStr = newStr.substring(0, start).trim()
    }
  })

  setQuery(newStr)
}

export const updateQuestion = (currQuestion: Question, updateCurrQuestion) =&gt; {
  const context = [
    &#x27;Les administrations concernées par cette question sont : &#x27;,
    &#x27;La question porte sur les thèmes suivants : &#x27;,
  ]

  let newStr = currQuestion.query

  context.forEach((c) =&gt; {
    const start = newStr.indexOf(c)

    if (start !== -1) {
      newStr = newStr.substring(0, start).trim()
    }
  })

  updateCurrQuestion({
    ...currQuestion,
    query: newStr,
  })
}

/***************************
		SP SHEETS
 **************************/

const setIndexesBody = (data, name, limit: number, streamId: string) =&gt; {
  const body = JSON.stringify({
    name: name,
    query: data.question,
    limit: limit,
    similarity: &#x27;e5&#x27;,
    institution: &#x27;&#x27;,
    must_not_sids: data.must_not_sids,
    stream_id: streamId,
  })

  return body
}

/* retrieve chunks or sheets */
export const getIndexes = async (
  data,
  dispatch,
  indexType: &#x27;sheets&#x27; | &#x27;chunks&#x27;,
  chunkSize: number,
  streamId: string,
  indexesUrl: string
) =&gt; {
  const actionType = indexType === &#x27;sheets&#x27; ? &#x27;SET_SHEETS&#x27; : &#x27;SET_CHUNKS&#x27;
  if (indexType === &#x27;sheets&#x27; &amp;&amp; data.must_not_sids.length !== 0) return
  try {
    const res = await useFetch(indexesUrl, &#x27;POST&#x27;, {
      data: setIndexesBody(data, indexType, chunkSize, streamId),
      headers: setHeaders(false),
    })
    dispatch({ type: actionType, [indexType]: res })
  } catch (error) {
    console.error(&#x27;An error occurred: &#x27;, error)
  }
}

/*
 * Get the sheets from the stream
 */
export const setIndexesData = (
  data: {
    question: string
    must_not_sids: string[]
  },
  setTiles: React.Dispatch&lt;React.SetStateAction&lt;any[]&gt;&gt;,
  dispatch,
  streamId: string,
  indexesUrl: string
) =&gt; {
  setTiles([])

  if (!data || !data.question || data.question.length === 0) return
  getIndexes(data, dispatch, &#x27;sheets&#x27;, 10, streamId, indexesUrl)
}

export const setTilesFromSheets = (sheets: Sheet[], setTiles: (any) =&gt; void) =&gt; {
  setTiles([])
  if (!sheets || !sheets.length) return

  sheets.map((sheet) =&gt; {
    const url = sheet.url
    const parsedUrl = new URL(url)
    let domain = parsedUrl.hostname

    domain = domain.replace(/^www\./, &#x27;&#x27;)
    domain = domain.replace(/^entreprendre\./, &#x27;&#x27;)

    const newTile: Tile = {
      linkProps: { href: sheet.url },
      enlargeLink: false,
      title: (
        &lt;&gt;
          &lt;p className=&quot;fr-badge fr-badge--sm fr-badge--purple-glycine fr-mb-1v&quot;&gt;
            {sheet.surtitre}
          &lt;/p&gt;
          &lt;p&gt;{sheet.title}&lt;/p&gt;
        &lt;/&gt;
      ),
      desc: &lt;&gt;{domain}&lt;/&gt;,
    }
    setTiles((prevTiles: Tile[]) =&gt; [...prevTiles, newTile])
  })
}
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:35,&quot;character&quot;:32,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:37,&quot;character&quot;:4,&quot;text&quot;:&quot;institution&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:37,&quot;character&quot;:17,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:37,&quot;character&quot;:26,&quot;text&quot;:&quot;institution&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:4,&quot;text&quot;:&quot;query&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:11,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:20,&quot;text&quot;:&quot;query&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:4,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:13,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:22,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:40,&quot;character&quot;:4,&quot;text&quot;:&quot;links&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:40,&quot;character&quot;:11,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:40,&quot;character&quot;:20,&quot;text&quot;:&quot;links&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:41,&quot;character&quot;:4,&quot;text&quot;:&quot;temperature&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:41,&quot;character&quot;:17,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:41,&quot;character&quot;:26,&quot;text&quot;:&quot;temperature&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:42,&quot;character&quot;:4,&quot;text&quot;:&quot;model_name&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:42,&quot;character&quot;:16,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:42,&quot;character&quot;:25,&quot;text&quot;:&quot;model_name&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:43,&quot;character&quot;:4,&quot;text&quot;:&quot;limit&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:43,&quot;character&quot;:11,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:43,&quot;character&quot;:20,&quot;text&quot;:&quot;limit&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:44,&quot;character&quot;:4,&quot;text&quot;:&quot;mode&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:44,&quot;character&quot;:10,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:44,&quot;character&quot;:19,&quot;text&quot;:&quot;mode&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:45,&quot;character&quot;:4,&quot;text&quot;:&quot;sources&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:45,&quot;character&quot;:13,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:45,&quot;character&quot;:22,&quot;text&quot;:&quot;sources&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:46,&quot;character&quot;:4,&quot;text&quot;:&quot;must_not_sids&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:46,&quot;character&quot;:19,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:46,&quot;character&quot;:28,&quot;text&quot;:&quot;must_not_sids&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:54,&quot;character&quot;:2,&quot;text&quot;:&quot;text&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:61,&quot;character&quot;:4,&quot;text&quot;:&quot;query&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:61,&quot;character&quot;:11,&quot;text&quot;:&quot;text&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:73,&quot;character&quot;:57,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:74,&quot;character&quot;:26,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:74,&quot;character&quot;:34,&quot;text&quot;:&quot;administrations&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:74,&quot;character&quot;:50,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:76,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:76,&quot;character&quot;:14,&quot;text&quot;:&quot;administrations&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:76,&quot;character&quot;:30,&quot;text&quot;:&quot;map&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:76,&quot;character&quot;:35,&quot;text&quot;:&quot;adminstration&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:76,&quot;character&quot;:53,&quot;text&quot;:&quot;adminstration&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:78,&quot;character&quot;:17,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:78,&quot;character&quot;:25,&quot;text&quot;:&quot;themes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:78,&quot;character&quot;:32,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:80,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:80,&quot;character&quot;:14,&quot;text&quot;:&quot;themes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:80,&quot;character&quot;:21,&quot;text&quot;:&quot;map&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:80,&quot;character&quot;:26,&quot;text&quot;:&quot;theme&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:80,&quot;character&quot;:36,&quot;text&quot;:&quot;theme&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:109,&quot;character&quot;:55,&quot;text&quot;:&quot;updateCurrQuestion&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:125,&quot;character&quot;:2,&quot;text&quot;:&quot;updateCurrQuestion&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:135,&quot;character&quot;:24,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:135,&quot;character&quot;:30,&quot;text&quot;:&quot;name&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:137,&quot;character&quot;:4,&quot;text&quot;:&quot;name&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:137,&quot;character&quot;:10,&quot;text&quot;:&quot;name&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:138,&quot;character&quot;:4,&quot;text&quot;:&quot;query&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:138,&quot;character&quot;:11,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:138,&quot;character&quot;:16,&quot;text&quot;:&quot;question&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:142,&quot;character&quot;:4,&quot;text&quot;:&quot;must_not_sids&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:142,&quot;character&quot;:19,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:142,&quot;character&quot;:24,&quot;text&quot;:&quot;must_not_sids&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:151,&quot;character&quot;:2,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:152,&quot;character&quot;:2,&quot;text&quot;:&quot;dispatch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:159,&quot;character&quot;:32,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:159,&quot;character&quot;:37,&quot;text&quot;:&quot;must_not_sids&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:159,&quot;character&quot;:51,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:161,&quot;character&quot;:10,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:162,&quot;character&quot;:27,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:165,&quot;character&quot;:4,&quot;text&quot;:&quot;dispatch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:165,&quot;character&quot;:46,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:167,&quot;character&quot;:41,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:166,&quot;character&quot;:11,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:180,&quot;character&quot;:2,&quot;text&quot;:&quot;dispatch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:187,&quot;character&quot;:19,&quot;text&quot;:&quot;dispatch&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/setData.tsx&quot;,&quot;line&quot;:190,&quot;character&quot;:63,&quot;text&quot;:&quot;any&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 25 Feb 2024 17:47:59 GMT</p>
    </body>
  </html>
  