
  <!DOCTYPE html>
  <html>
    <head>
      <title>Login.tsx</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/pages/Login.tsx</td><td class="">80.31%</td><td class="">80%</td><td class="">127</td><td class="">102</td><td class="">25</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { ButtonsGroup } from &#x27;@codegouvfr/react-dsfr/ButtonsGroup&#x27;
import { Dispatch, SetStateAction, useEffect, useState } from &#x27;react&#x27;
import { UserAuth } from &#x27;src/utils/auth&#x27;
import { LoginContainer } from &#x27;../components/Auth/LoginContainer&#x27;
import { LoginFields } from &#x27;../components/Auth/LoginFields&#x27;
import { ButtonInformation } from &#x27;../components/Global/ButtonInformation&#x27;
import { useApiUrls } from &#x27;../constants/api&#x27;
import { initButtonsLogin } from &#x27;../constants/connexion&#x27;
import { usernameOrPasswordError } from &#x27;../constants/errorMessages&#x27;
import { loginFields } from &#x27;../constants/inputFields&#x27;
import { useFetch } from &#x27;../utils/hooks&#x27;
import { setUserInfos } from &#x27;../utils/manageConnexion&#x27;

interface LoginProps {
  authFailed: boolean
  setAuthFailed: Dispatch&lt;SetStateAction&lt;boolean&gt;&gt;
  setUserAuth: Dispatch&lt;SetStateAction&lt;UserAuth&gt;&gt;
}

export function Login({ authFailed, setAuthFailed, setUserAuth }: LoginProps) {
  const [isDisable, setIsDisable] = useState(true)
  const [password, setPassword] = useState(&#x27;&#x27;)
  const [id, setId] = useState(&#x27;&#x27;)
  const { signinUrl, userUrl } = useApiUrls()

  useEffect(() =&gt; {
    checkIfCompletedFields()
  }, [password])

  const checkIfCompletedFields = () =&gt; {
    if (password.length &amp;&amp; ((id &amp;&amp; id.length) || (password &amp;&amp; password.length)))
      setIsDisable(false)
    else setIsDisable(true)
  }

  const handleChange = (e) =&gt; {
    e.preventDefault()

    if (e.target.name === &#x27;username&#x27;) setId(e.target.value)
    if (e.target.name === &#x27;password&#x27;) setPassword(e.target.value)

    checkIfCompletedFields()
  }

  const handleSubmit = async () =&gt; {
    const data = id.includes(&#x27;@&#x27;)
      ? { email: id, password: password }
      : { username: id, password: password }

    setAuthFailed(false)

    try {
      const res = await useFetch(signinUrl, &#x27;POST&#x27;, {
        data: JSON.stringify(data),
        headers: { &#x27;Content-Type&#x27;: &#x27;application/json&#x27; },
      })

      if ((res.status &amp;&amp; res.success !== true) || !res.token) {
        // Set authFailed to true if the response status is not 200 or token is not received

        setAuthFailed(true)
      } else {
        // On successful authentication, set user info
        setUserInfos(res.token, setUserAuth, userUrl)
      }
    } catch (error) {
      setAuthFailed(true)
    }
  }

  return (
    &lt;LoginContainer&gt;
      &lt;LoginFields
        fields={loginFields}
        handleChange={handleChange}
        handleSubmit={handleSubmit}
      /&gt;
      {authFailed &amp;&amp; &lt;ButtonInformation&gt;{usernameOrPasswordError}&lt;/ButtonInformation&gt;}
      &lt;ButtonsGroup buttons={initButtonsLogin(handleSubmit, isDisable)} /&gt;
    &lt;/LoginContainer&gt;
  )
}
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:35,&quot;character&quot;:24,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:36,&quot;character&quot;:4,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:36,&quot;character&quot;:6,&quot;text&quot;:&quot;preventDefault&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:8,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:10,&quot;text&quot;:&quot;target&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:17,&quot;text&quot;:&quot;name&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:44,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:46,&quot;text&quot;:&quot;target&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:38,&quot;character&quot;:53,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:8,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:10,&quot;text&quot;:&quot;target&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:17,&quot;text&quot;:&quot;name&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:50,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:52,&quot;text&quot;:&quot;target&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:39,&quot;character&quot;:59,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:52,&quot;character&quot;:12,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:57,&quot;character&quot;:11,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:57,&quot;character&quot;:15,&quot;text&quot;:&quot;status&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:57,&quot;character&quot;:25,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:57,&quot;character&quot;:29,&quot;text&quot;:&quot;success&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:57,&quot;character&quot;:51,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:57,&quot;character&quot;:55,&quot;text&quot;:&quot;token&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:63,&quot;character&quot;:21,&quot;text&quot;:&quot;res&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:63,&quot;character&quot;:25,&quot;text&quot;:&quot;token&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/pages/Login.tsx&quot;,&quot;line&quot;:65,&quot;character&quot;:13,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 25 Feb 2024 17:47:59 GMT</p>
    </body>
  </html>
  